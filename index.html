<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œæ”¿ç¨‹åºå·¥å…·ç®±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; font-family: system-ui, -apple-system, sans-serif; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .tab-active { color: #1e40af; border-bottom: 2px solid #1e40af; }
        .btn-active { background-color: #1e40af !important; color: white !important; }
        input[type="date"], input[type="number"], select { -webkit-appearance: none; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-md mx-auto">
        <div class="card overflow-hidden border border-slate-200">
            <div class="flex border-b border-slate-100 bg-slate-50/50">
                <button onclick="switchMode('calc')" id="tab-calc" class="flex-1 py-4 text-sm font-bold text-slate-400 transition-all tab-active">
                    ğŸ—“ï¸ æœŸé–“è¨ˆç®—
                </button>
                <button onclick="switchMode('overdue')" id="tab-overdue" class="flex-1 py-4 text-sm font-bold text-slate-400 transition-all">
                    âš ï¸ é€¾æœŸè¨ˆç®—
                </button>
            </div>

            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-wider">æ¡ˆä»¶æ€§è³ª</label>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <button onclick="setType('normal')" id="btn-normal" class="btn-active flex-1 py-2 rounded-lg text-sm font-bold transition-all">ä¸€èˆ¬æ¡ˆä»¶</button>
                        <button onclick="setType('adverse')" id="btn-adverse" class="flex-1 py-2 rounded-lg text-sm font-bold text-slate-500 transition-all">ä¸åˆ©è™•åˆ†</button>
                    </div>
                    <p id="type-desc" class="text-[10px] text-slate-400 mt-2 italic">â€» ä¸€èˆ¬æ¡ˆä»¶ï¼šæœ«æ—¥é‡å‡æ—¥é †å»¶ã€‚</p>
                </div>

                <hr class="mb-6 border-slate-100">

                <div id="section-calc" class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">é€é”æ—¥æœŸ (å§‹æ—¥)</label>
                        <input type="date" id="startDate" class="w-full p-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-[2]">
                            <label class="block text-xs font-bold text-slate-500 mb-1">æœŸé–“é•·åº¦</label>
                            <input type="number" id="periodValue" value="30" class="w-full p-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex-1">
                            <label class="block text-xs font-bold text-slate-500 mb-1">å–®ä½</label>
                            <select id="periodUnit" class="w-full p-3 rounded-xl border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="day">æ—¥</option>
                                <option value="month">æœˆ</option>
                                <option value="year">å¹´</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="runCalc()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95">
                        åŸ·è¡Œè¨ˆç®—
                    </button>
                </div>

                <div id="section-overdue" class="space-y-5 hidden">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">ç¾æ³æ—¥æœŸ / é›¢å¢ƒæ—¥æœŸ (æ—¥æœŸä¸€)</label>
                        <input type="date" id="date1" class="w-full p-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">ç•™æ•ˆæœŸæˆªæ­¢æ—¥ (æ—¥æœŸäºŒ)</label>
                        <input type="date" id="date2" class="w-full p-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="runOverdue()" class="w-full bg-slate-800 hover:bg-black text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95">
                        è¨ˆç®—é€¾æœŸå¤©æ•¸
                    </button>
                </div>

                <div id="result-area" class="mt-8 hidden border-t border-dashed pt-6">
                    <div id="status-card" class="p-5 rounded-2xl transition-all">
                        <div id="res-title" class="text-[10px] font-black uppercase tracking-widest mb-1"></div>
                        <div id="res-main" class="text-3xl font-black"></div>
                        <div id="res-sub" class="text-sm font-bold mt-1"></div>
                        <div id="res-total-days" class="text-xs font-bold mt-2 text-slate-600"></div> <div id="res-detail" class="text-xs mt-3 leading-relaxed opacity-80"></div>
                    </div>
                    
                    <div id="holiday-warn" class="hidden mt-4 p-2 bg-amber-50 border border-amber-100 text-amber-600 text-[10px] rounded-lg text-center">
                        âš ï¸ æŸ¥ç„¡è©²å¹´åœ‹å®šå‡æ—¥è³‡æ–™ï¼Œæ”¹ä»¥é€±å…­æ—¥åˆ¤å®šã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const HOLIDAY_DATA = {"2018":["1000011000001100000110000011000","0011000001100011111100011001","0011000001100000110000011000000","100111110000011000001100000110","0000110000011000001100000110000","011000001100000111000011000001","1000001100000110000011000001100","0001100000110000011000001100000","110000011000001100000111000011","0000011001001100000110000011000","001100000110000011000001100000","1100000110000011000000100000111"],"2019":["1000110000011000000100000110000","0111111111000001100000010001","1110000011000001100000110000011","000111100000110000011000001100","0001100000110000011000001100000","110000111000001100000110000011","0000011000001100000110000011000","0011000001100000110000011000001","100000110000111000001100000110","0000010001111000001100000110000","011000001100000110000011000001","1000001100000110000011000001100"],"2020":["1001100000110000011000111111100","11000001100000010000011000011","1000001100000110000011000001100","011110000011000001100000110000","0110000011000001100000110000011","000001100000110000001000111100","0001100000110000011000001100000","1100000110000011000001100000110","000011000001100000110000001000","1111000011100000110000011000001","100000110000011000001100000110","0000110000011000001100000110000"],"2021":["1110000011000001100000110000011","0000011001111111000010000011","1000011000001100000110000011000","011110000110000011000001100000","1100000110000011000001100000110","000011000001110000110000011000","0011000001100000110000011000001","1000001100000110000011000001100","000110000001000001111000110000","0110000011100001100000110000011","000001100000110000011000001100","0001100000110000011000001100001"],"2022":["1100000110000011000000100000111","1111110000011000001100000111","0000110000011000001100000110000","011110001100000110000011000001","1000001100000110000011000001100","001110000011000001100000110000","0110000011000001100000110000011","0000011000001100000110000011000","001100001110000011000001100000","1100000111000011000001100000110","000011000001100000110000011000","0011000001100000110000011000001"],"2023":["1100000100000110000111111111100","0000100000110000001000001111","0001100000110000011000000100000","111110011000001100000110000011","0000011000001100000110000011000","001100000110000001000111100000","1100000110000011000001100000110","0000110000011000001100000110000","011000001100000110000001000011","1000001111000110000011000001100","000110000011000001100000110000","0110000011000001100000110000011"],"2024":["1000011000001100000110000011000","00110001111111000100000110010","0110000011000001100000110000011","000111100000110000011000001100","0001100000110000011000001100000","110000011100001100000110000011","0000011000001100000110000011000","0011000001100000110000011000001","100000110000011010001100000110","0000110001011000001100000110000","011000001100000110000011000001","1000001100000110000011000001100"],"2025":["1001100000110000011000001111111","1100000010000011000001100001","1100000110000011000001100000110","001111000001100000110000011000","0011000001100000110000011000011","100000110000011000001100000110","0000110000011000001100000110000","0110000011000001100000110000011","000001100000110000011000001110","0001110001110000011000011100000","110000011000001100000110000011","0000011000001100000110001011000"],"2026":["1011000001100000110000011000001","1000001100000111111111000011","1000001100000110000011000001100","001111000011000001100000110000","1110000011000001100000110000011","000001100000110000111000001100","0001100000110000011000001100000","1100000110000011000001100000110","000011000001100000110000111100","0011000011100000110000011100001","100000110000011000001100000110","0000110000011000001100001110000"]};

        let currentType = 'normal';
        let currentMode = 'calc';
        const weekNames = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('section-calc').classList.toggle('hidden', mode !== 'calc');
            document.getElementById('section-overdue').classList.toggle('hidden', mode !== 'overdue');
            document.getElementById('tab-calc').className = mode === 'calc' ? 'flex-1 py-4 text-sm font-bold tab-active' : 'flex-1 py-4 text-sm font-bold text-slate-400';
            document.getElementById('tab-overdue').className = mode === 'overdue' ? 'flex-1 py-4 text-sm font-bold tab-active' : 'flex-1 py-4 text-sm font-bold text-slate-400';
            document.getElementById('result-area').classList.add('hidden');
        }

        function setType(type) {
            currentType = type;
            const isNormal = type === 'normal';
            document.getElementById('btn-normal').className = isNormal ? 'btn-active flex-1 py-2 rounded-lg text-sm font-bold transition-all' : 'flex-1 py-2 rounded-lg text-sm font-bold text-slate-500 transition-all';
            document.getElementById('btn-adverse').className = !isNormal ? 'btn-active flex-1 py-2 rounded-lg text-sm font-bold transition-all' : 'flex-1 py-2 rounded-lg text-sm font-bold text-slate-500 transition-all';
            document.getElementById('type-desc').innerText = isNormal ? "â€» ä¸€èˆ¬æ¡ˆä»¶ï¼šæœ«æ—¥é‡å‡æ—¥é †å»¶ã€‚" : "â€» ä¸åˆ©è™•åˆ†ï¼šå§‹æ—¥è¨ˆ 1 æ—¥ï¼Œå‡æ—¥ç…§è¨ˆä¸”ä¸é †å»¶ã€‚";
        }

        function isHoliday(date) {
            const y = date.getFullYear();
            const m = date.getMonth();
            const d = date.getDate();
            if (HOLIDAY_DATA[y]) {
                document.getElementById('holiday-warn').classList.add('hidden');
                return HOLIDAY_DATA[y][m].charAt(d - 1) === "1";
            } else {
                document.getElementById('holiday-warn').classList.remove('hidden');
                const dow = date.getDay();
                return (dow === 0 || dow === 6);
            }
        }

        function runCalc() {
            const startStr = document.getElementById('startDate').value;
            if (!startStr) return alert("è«‹é¸æ“‡æ—¥æœŸ");
            
            const period = parseInt(document.getElementById('periodValue').value);
            const unit = document.getElementById('periodUnit').value;
            let startDate = new Date(startStr);
            startDate.setHours(0,0,0,0);
            
            let endDate = new Date(startStr);
            endDate.setHours(0,0,0,0);
            let detail = "";

            if (currentType === 'normal') {
                detail = "ä¸€èˆ¬æ¡ˆä»¶ï¼ˆå§‹æ—¥ä¸è¨ˆï¼‰ï¼š";
                if (unit === 'day') endDate.setDate(endDate.getDate() + period);
                else if (unit === 'month') endDate.setMonth(endDate.getMonth() + period);
                else endDate.setFullYear(endDate.getFullYear() + period);

                let skipCount = 0;
                while (isHoliday(endDate)) {
                    endDate.setDate(endDate.getDate() + 1);
                    skipCount++;
                }
                detail += skipCount > 0 ? `æœ«æ—¥é€¢å‡æ—¥ï¼Œé †å»¶ ${skipCount} å¤©ã€‚` : "æœ«æ—¥éå‡æ—¥ã€‚";
            } else {
                detail = "ä¸åˆ©è™•åˆ†ï¼ˆå§‹æ—¥è¨ˆ 1 æ—¥ï¼‰ï¼š";
                if (unit === 'day') endDate.setDate(endDate.getDate() + (period - 1));
                else {
                    if (unit === 'month') endDate.setMonth(endDate.getMonth() + period);
                    else endDate.setFullYear(endDate.getFullYear() + period);
                    endDate.setDate(endDate.getDate() - 1);
                }
                detail += "å‡æ—¥ç…§è¨ˆï¼Œä¸äºˆé †å»¶ã€‚";
            }

            // è¨ˆç®—ã€Œå…±å¹¾å¤©ã€(åŒ…å«é ­å°¾å¤©æ•¸å·®)
            const totalDays = Math.round((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1;

            showResult(
                "å±†æ»¿æ—¥æœŸ (æœ«æ—¥)",
                endDate.toISOString().split('T')[0],
                weekNames[endDate.getDay()],
                detail,
                "blue",
                `ç¸½è¨ˆï¼š${totalDays} å¤©`
            );
        }

        function runOverdue() {
            const val1 = document.getElementById('date1').value;
            const val2 = document.getElementById('date2').value;
            if (!val1 || !val2) return alert("è«‹è¼¸å…¥å®Œæ•´æ—¥æœŸ");

            let date1 = new Date(val1);
            let legalDeadline = new Date(val2);

            let skipDesc = "";
            if (currentType === 'normal') {
                let count = 0;
                while (isHoliday(legalDeadline)) {
                    legalDeadline.setDate(legalDeadline.getDate() + 1);
                    count++;
                }
                if (count > 0) skipDesc = `æœ«æ—¥é©é€¢å‡æ—¥ï¼Œæ³•å®šæˆªæ­¢æ—¥å·²é †å»¶è‡³ ${legalDeadline.toISOString().split('T')[0]}ã€‚`;
            } else {
                skipDesc = "ä¸åˆ©è™•åˆ†ï¼šæœ«æ—¥é‡å‡æ—¥ä¸é †å»¶ã€‚";
            }

            date1.setHours(0,0,0,0);
            legalDeadline.setHours(0,0,0,0);
            const diffDays = Math.ceil((date1.getTime() - legalDeadline.getTime()) / (1000 * 60 * 60 * 24));

            if (diffDays > 0) {
                showResult("ç‹€æ…‹ï¼šé€¾æœŸä¸­", `${diffDays} å¤©`, `æˆªæ­¢æ—¥ï¼š${legalDeadline.toISOString().split('T')[0]}`, skipDesc, "rose", "");
            } else {
                showResult("ç‹€æ…‹ï¼šæ•ˆæœŸå…§", `å‰©é¤˜ ${Math.abs(diffDays)} å¤©`, `æˆªæ­¢æ—¥ï¼š${legalDeadline.toISOString().split('T')[0]}`, skipDesc, "emerald", "");
            }
        }

        function showResult(title, main, sub, detail, themeColor, totalStr) {
            const resArea = document.getElementById('result-area');
            const card = document.getElementById('status-card');
            resArea.classList.remove('hidden');
            
            document.getElementById('res-title').innerText = title;
            document.getElementById('res-main').innerText = main;
            document.getElementById('res-sub').innerText = sub;
            document.getElementById('res-detail').innerText = detail;
            
            const totalBox = document.getElementById('res-total-days');
            if (totalStr) {
                totalBox.innerText = totalStr;
                totalBox.classList.remove('hidden');
            } else {
                totalBox.classList.add('hidden');
            }

            const themes = {
                blue: "bg-blue-50 text-blue-700 border border-blue-100",
                rose: "bg-rose-50 text-rose-700 border border-rose-100",
                emerald: "bg-emerald-50 text-emerald-700 border border-emerald-100"
            };
            card.className = `p-5 rounded-2xl transition-all ${themes[themeColor]}`;
        }

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('startDate').value = today;
        document.getElementById('date1').value = today;
    </script>
</body>
</html>
